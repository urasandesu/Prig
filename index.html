<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Prig: Open Source Alternative to Microsoft Fakes By: @urasandesu</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Prig</h1>
        <p class="header">Open Source Alternative to Microsoft Fakes</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/urasandesu/Prig/releases/download/v2.2.0/Prig.vsix">Download VSIX</a></li>
          <li class="download"><a class="buttons" href="https://github.com/urasandesu/Prig/releases/download/v2.2.0/Prig.2.2.0.nupkg">Download Nupkg</a></li>
          <li class="download"><a class="buttons" href="https://github.com/urasandesu/Prig/releases/download/v2.2.0/Prig-v2.2.0.zip">Download SRC</a></li>
          <li><a class="buttons github" href="https://github.com/urasandesu/Prig">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/urasandesu">urasandesu</a></p>


      </header>
      <section>
        <h1>
<a id="prig-open-source-alternative-to-microsoft-fakes" class="anchor" href="#prig-open-source-alternative-to-microsoft-fakes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Prig: Open Source Alternative to Microsoft Fakes</h1>

<p><img src="https://cdn.rawgit.com/urasandesu/Prig/master/Urasandesu.Prig.VSPackage/Resources/PrigPreviewImage.png" alt="Prig"></p>

<p>Prig(PRototyping jIG) is a framework that generates a <a href="http://martinfowler.com/bliki/TestDouble.html">Test Double</a> like <a href="http://msdn.microsoft.com/en-us/library/hh549175.aspx">Microsoft Fakes</a>/<a href="http://www.typemock.com/isolator-product-page">Typemock Isolator</a>/<a href="http://www.telerik.com/products/mocking.aspx">Telerik JustMock</a> based on Unmanaged Profiler APIs.
This framework enables that any methods are replaced with mocks. For example, a static property, a private method, a non-virtual member and so on.</p>

<h2>
<a id="status" class="anchor" href="#status" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>STATUS</h2>

<p>As of Feb 21, 2016, Released V2.2.0.</p>

<h2>
<a id="quick-tour" class="anchor" href="#quick-tour" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>QUICK TOUR</h2>

<p>Let's say you want to test the following code: </p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> System<span class="pl-k">;</span>

<span class="pl-k">namespace</span> <span class="pl-en">QuickTour</span>
{
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">LifeInfo</span>
    {
        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">bool</span> <span class="pl-en">IsNowLunchBreak</span>()
        {
            <span class="pl-k">var</span> now = DateTime.Now;
            <span class="pl-k">return</span> <span class="pl-c1">12</span> &lt;= now.Hour &amp;&amp; now.Hour &lt; <span class="pl-c1">13</span>;
        }
    }
}</pre></div>

<p>You probably can't test this code, because <code>DateTime.Now</code> returns the value that depends on an external environment. To make be testable, you should replace <code>DateTime.Now</code> to the Test Double that returns the fake information. If you use Prig, it will enable you to generate a Test Double by the following steps without any editing the product code:</p>

<h3>
<a id="step-1-install-from-visual-studio-gallery" class="anchor" href="#step-1-install-from-visual-studio-gallery" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 1: Install From Visual Studio Gallery</h3>

<p>Run Visual Studio 2013(Community or more, 2015 is also supported) as Administrator and choose <code>TOOLS</code> - <code>Extensions and Updates...</code>.<br>
<img src="https://cdn.rawgit.com/urasandesu/Prig/master/Urasandesu.Prig.VSPackage/Resources/Step%201%20Install%20From%20Visual%20Studio%20Gallery%2001.png" alt="Extensions and Updates... menu"></p>

<p>Now in the Extensions and Updates window, take the following steps:</p>

<ol>
<li>On the left side, ensure <code>Visual Studio Gallery</code> is selected under <code>Online</code>.</li>
<li>In the search box in the upper right corner, type <code>prig</code>.</li>
<li>Select the <code>Prig</code> package, and click <code>Download</code>.</li>
</ol>

<p><img src="https://cdn.rawgit.com/urasandesu/Prig/master/Urasandesu.Prig.VSPackage/Resources/Step%201%20Install%20From%20Visual%20Studio%20Gallery%2002.png" alt="Extensions and Updates dialog"></p>

<p><strong>NOTE:</strong> Prig requires PowerShell v3.0+. If you want to use Prig in Windows 7, please install <a href="https://www.microsoft.com/en-us/download/details.aspx?id=34595">Windows Management Framework 3.0+</a> beforehand. <a href="https://github.com/urasandesu/Prig/issues/41">See also this issue</a>.</p>

<p>Once restart Visual Studio, you can find <code>PRIG</code> in the menu. Choose <code>PRIG</code> - <code>Register Prig (Needs Restarting)</code>.<br>
<img src="https://cdn.rawgit.com/urasandesu/Prig/master/Urasandesu.Prig.VSPackage/Resources/Step%201%20Install%20From%20Visual%20Studio%20Gallery%2003.png" alt="Register Prig menu"></p>

<p>Finally restart Visual Studio then you are now ready.</p>

<h3>
<a id="step-2-add-stub-settings" class="anchor" href="#step-2-add-stub-settings" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 2: Add Stub Settings</h3>

<p>Add test project(e.g. <code>QuickTourTest</code>). Then, right click <code>References</code> and choose <code>Add Prig Assembly for mscorlib</code>:<br>
<img src="https://cdn.rawgit.com/urasandesu/Prig/master/Urasandesu.Prig.VSPackage/Resources/Step%202%20Add%20Stub%20Settings.png" alt="Add Stub Settings"></p>

<h3>
<a id="step-3-modify-stub-settings" class="anchor" href="#step-3-modify-stub-settings" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 3: Modify Stub Settings</h3>

<p>You can find the <a href="https://github.com/urasandesu/Prig/wiki/Cheat-Sheet#stub_settings_file">Stub Settings File</a> <code>&lt;assembly name&gt;.&lt;runtime version&gt;.v&lt;assembly version&gt;.prig</code> in the project(in this case, it is <code>mscorlib.v4.0.30319.v4.0.0.0.prig</code>). So, right click the file and choose <code>Edit Prig Indirection Settings</code>:<br>
<img src="https://cdn.rawgit.com/urasandesu/Prig/master/Urasandesu.Prig.VSPackage/Resources/Step%203%20Modify%20Stub%20Settings%2001.png" alt="Edit Prig Indirection Settings"></p>

<p>Then, <a href="https://github.com/urasandesu/Prig/wiki/Cheat-Sheet#prig_setup_session">Prig Setup Session</a> will start:<br>
<img src="https://cdn.rawgit.com/urasandesu/Prig/master/Urasandesu.Prig.VSPackage/Resources/Step%203%20Modify%20Stub%20Settings%2002.png" alt="Prig Setup Session"></p>

<div class="highlight highlight-source-powershell"><pre>Welcome to Prig Setup Session<span class="pl-k">!!</span>


You can add the Stub Settings File <span class="pl-k">from</span> here. <span class="pl-k">In</span> this session<span class="pl-k">,</span> you can use <span class="pl-cce">`$</span>ReferencedAssemblies<span class="pl-k">`</span> that contains all
referenced assemblies information of current project. <span class="pl-k">For</span> example<span class="pl-k">,</span> <span class="pl-k">if</span> you want to get the indirection settings <span class="pl-k">for</span> all
members of the type <span class="pl-k">`</span>Foo<span class="pl-k">`</span> that belongs to the referenced assembly <span class="pl-k">`</span>UntestableLibrary<span class="pl-k">`,</span> the following commands will achi
eve it:

PS<span class="pl-k">&gt;</span> <span class="pl-k">$</span><span class="pl-smi">ReferencedAssemblies</span>

FullName
<span class="pl-k">--------</span>
mscorlib<span class="pl-k">,</span> Version<span class="pl-k">=</span><span class="pl-c1"><span class="pl-c1">2.0</span></span>.<span class="pl-c1"><span class="pl-c1">0.0</span></span><span class="pl-k">,</span> Culture<span class="pl-k">=</span>neutral<span class="pl-k">,</span> PublicKeyToken<span class="pl-k">=</span>b77a5c561934e089
System<span class="pl-k">,</span> Version<span class="pl-k">=</span><span class="pl-c1"><span class="pl-c1">2.0</span></span>.<span class="pl-c1"><span class="pl-c1">0.0</span></span><span class="pl-k">,</span> Culture<span class="pl-k">=</span>neutral<span class="pl-k">,</span> PublicKeyToken<span class="pl-k">=</span>b77a5c561934e089
MyLibrary<span class="pl-k">,</span> Version<span class="pl-k">=</span><span class="pl-c1"><span class="pl-c1">1.0</span></span>.<span class="pl-c1"><span class="pl-c1">0.0</span></span><span class="pl-k">,</span> Culture<span class="pl-k">=</span>neutral<span class="pl-k">,</span> PublicKeyToken<span class="pl-k">=</span>null
UntestableLibrary<span class="pl-k">,</span> Version<span class="pl-k">=</span><span class="pl-c1"><span class="pl-c1">1.0</span></span>.<span class="pl-c1"><span class="pl-c1">0.0</span></span><span class="pl-k">,</span> Culture<span class="pl-k">=</span>neutral<span class="pl-k">,</span> PublicKeyToken<span class="pl-k">=</span>null


PS<span class="pl-k">&gt;</span> padd <span class="pl-k">-</span>ra <span class="pl-k">$</span><span class="pl-smi">ReferencedAssemblies</span><span class="pl-e">[</span><span class="pl-k">-</span><span class="pl-c1"><span class="pl-c1">1</span></span><span class="pl-e">]</span>
PS<span class="pl-k">&gt;</span> <span class="pl-k">$</span><span class="pl-smi">ReferencedAssemblies</span><span class="pl-e">[</span><span class="pl-k">-</span><span class="pl-c1"><span class="pl-c1">1</span></span><span class="pl-e">]</span>.GetTypes<span class="pl-k">()</span> <span class="pl-k">|</span> <span class="pl-k">?</span> { <span class="pl-k">$</span><span class="pl-c1">_</span><span class="pl-en">.Name</span> <span class="pl-k">-eq</span> <span class="pl-s">'Foo'</span> } <span class="pl-k">|</span> pfind <span class="pl-k">|</span> pget <span class="pl-k">|</span> clip
PS<span class="pl-k">&gt;</span> <span class="pl-k">exit</span>   <span class="pl-c"># Then, paste the content on the clipboard to the Stub Settings File(e.g. `UntestableLibrary.v4.0.30319.v1.0.</span>
<span class="pl-c1"><span class="pl-c1">0.0</span></span>.prig<span class="pl-k">`</span>).



See also the command<span class="pl-s">'s help `padd`, `pfind` and `pget`.</span>
<span class="pl-s"></span>
<span class="pl-s"></span>
<span class="pl-s"></span>
<span class="pl-s">Current Project: QuickTourTest</span>
<span class="pl-s">WARNING: Change the Current Project from `Default Project: ` on the Package Manager Console if it isn'</span>t what you want.


<span class="pl-k">-</span>EditorialInclude parameter is specified. You can also use the global variable <span class="pl-k">$</span><span class="pl-smi">TargetReferencedAssembly</span> <span class="pl-k">in</span> addition to
 <span class="pl-k">$</span><span class="pl-smi">ReferencedAssemblies</span>. Currently <span class="pl-k">$</span><span class="pl-smi">TargetReferencedAssembly</span> is:

FullName
<span class="pl-k">--------</span>
mscorlib<span class="pl-k">,</span> Version<span class="pl-k">=</span><span class="pl-c1"><span class="pl-c1">4.0</span></span>.<span class="pl-c1"><span class="pl-c1">0.0</span></span><span class="pl-k">,</span> Culture<span class="pl-k">=</span>neutral<span class="pl-k">,</span> PublicKeyToken<span class="pl-k">=</span>b77a5c561934e089




PS <span class="pl-c1"><span class="pl-c1">01</span></span>.QuickTour<span class="pl-k">&gt;</span>
</pre></div>

<p>Now, we want to get the indirection setting for <code>DateTime.Now</code>. In this case, execute the following commands and copy it to the clipboard: </p>

<div class="highlight highlight-source-powershell"><pre>PS <span class="pl-c1"><span class="pl-c1">01</span></span>.QuickTour<span class="pl-k">&gt;</span> <span class="pl-k">$</span><span class="pl-smi">TargetReferencedAssembly</span><span class="pl-en">.GetTypes</span><span class="pl-k">()</span> <span class="pl-k">|</span> <span class="pl-k">?</span> { <span class="pl-k">$</span><span class="pl-c1">_</span><span class="pl-en">.Name</span> <span class="pl-k">-eq</span> <span class="pl-s">'datetime'</span> } <span class="pl-k">|</span> pfind <span class="pl-k">-</span>m <span class="pl-s">'get_Now'</span> <span class="pl-k">|</span> pget <span class="pl-k">|</span> clip
PS <span class="pl-c1"><span class="pl-c1">01</span></span>.QuickTour<span class="pl-k">&gt;</span> <span class="pl-k">exit</span></pre></div>

<p>Exit the <a href="https://github.com/urasandesu/Prig/wiki/Cheat-Sheet#prig_setup_session">Prig Setup Session</a>, and paste the copied information to the <a href="https://github.com/urasandesu/Prig/wiki/Cheat-Sheet#stub_settings_file">Stub Settings File</a>:<br>
<img src="https://cdn.rawgit.com/urasandesu/Prig/master/Urasandesu.Prig.VSPackage/Resources/Step%203%20Modify%20Stub%20Settings%2003.png" alt="Indirection Setting File"></p>

<div class="highlight highlight-text-xml"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span>?&gt;
&lt;<span class="pl-ent">configuration</span>&gt;

  &lt;<span class="pl-ent">configSections</span>&gt;
    &lt;<span class="pl-ent">section</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>prig<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>Urasandesu.Prig.Framework.PilotStubberConfiguration.PrigSection, Urasandesu.Prig.Framework<span class="pl-pds">"</span></span> /&gt;
  &lt;/<span class="pl-ent">configSections</span>&gt;

  &lt;<span class="pl-ent">prig</span>&gt;

    &lt;<span class="pl-ent">stubs</span>&gt;
      <span class="pl-c">&lt;!-- PASTE HERE --&gt;</span>
      &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>NowGet<span class="pl-pds">"</span></span> <span class="pl-e">alias</span>=<span class="pl-s"><span class="pl-pds">"</span>NowGet<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">RuntimeMethodInfo</span> <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">i</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">x</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.w3.org/2001/XMLSchema<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Id</span>=<span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">FactoryType</span>=<span class="pl-s"><span class="pl-pds">"</span>MemberInfoSerializationHolder<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Type</span>=<span class="pl-s"><span class="pl-pds">"</span>System.Reflection.MemberInfoSerializationHolder<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Assembly</span>=<span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">z</span>=<span class="pl-s"><span class="pl-pds">"</span>http://schemas.microsoft.com/2003/10/Serialization/<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span>http://schemas.datacontract.org/2004/07/System.Reflection<span class="pl-pds">"</span></span>&gt;
          &lt;<span class="pl-ent">Name</span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Id</span>=<span class="pl-s"><span class="pl-pds">"</span>2<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Type</span>=<span class="pl-s"><span class="pl-pds">"</span>System.String<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Assembly</span>=<span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>&gt;get_Now&lt;/<span class="pl-ent">Name</span>&gt;
          &lt;<span class="pl-ent">AssemblyName</span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Id</span>=<span class="pl-s"><span class="pl-pds">"</span>3<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Type</span>=<span class="pl-s"><span class="pl-pds">"</span>System.String<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Assembly</span>=<span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>&gt;mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/<span class="pl-ent">AssemblyName</span>&gt;
          &lt;<span class="pl-ent">ClassName</span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Id</span>=<span class="pl-s"><span class="pl-pds">"</span>4<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Type</span>=<span class="pl-s"><span class="pl-pds">"</span>System.String<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Assembly</span>=<span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>&gt;System.DateTime&lt;/<span class="pl-ent">ClassName</span>&gt;
          &lt;<span class="pl-ent">Signature</span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Id</span>=<span class="pl-s"><span class="pl-pds">"</span>5<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Type</span>=<span class="pl-s"><span class="pl-pds">"</span>System.String<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Assembly</span>=<span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>&gt;System.DateTime get_Now()&lt;/<span class="pl-ent">Signature</span>&gt;
          &lt;<span class="pl-ent">Signature2</span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Id</span>=<span class="pl-s"><span class="pl-pds">"</span>6<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Type</span>=<span class="pl-s"><span class="pl-pds">"</span>System.String<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Assembly</span>=<span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>&gt;System.DateTime get_Now()&lt;/<span class="pl-ent">Signature2</span>&gt;
          &lt;<span class="pl-ent">MemberType</span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Id</span>=<span class="pl-s"><span class="pl-pds">"</span>7<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Type</span>=<span class="pl-s"><span class="pl-pds">"</span>System.Int32<span class="pl-pds">"</span></span> <span class="pl-e">z</span><span class="pl-e">:</span><span class="pl-e">Assembly</span>=<span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>&gt;8&lt;/<span class="pl-ent">MemberType</span>&gt;
          &lt;<span class="pl-ent">GenericArguments</span> <span class="pl-e">i</span><span class="pl-e">:</span><span class="pl-e">nil</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span> /&gt;
        &lt;/<span class="pl-ent">RuntimeMethodInfo</span>&gt;
      &lt;/<span class="pl-ent">add</span>&gt;
      <span class="pl-c">&lt;!-- PASTE HERE --&gt;</span>
    &lt;/<span class="pl-ent">stubs</span>&gt;

  &lt;/<span class="pl-ent">prig</span>&gt;

&lt;/<span class="pl-ent">configuration</span>&gt;</pre></div>

<p>Were you able to build successfully? OK, now you're ready to test them.</p>

<h3>
<a id="step-4-make-tests" class="anchor" href="#step-4-make-tests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 4: Make Tests</h3>

<p>In the test code, it becomes testable through the use of the stub and the replacement to Test Double that returns the fake information: </p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> NUnit.Framework<span class="pl-k">;</span>
<span class="pl-k">using</span> QuickTour<span class="pl-k">;</span>
<span class="pl-k">using</span> System<span class="pl-k">;</span>
<span class="pl-k">using</span> System.Prig<span class="pl-k">;</span>
<span class="pl-k">using</span> Urasandesu.Prig.Framework<span class="pl-k">;</span>

<span class="pl-k">namespace</span> <span class="pl-en">QuickTourTest</span>
{
    [TestFixture]
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">LifeInfoTest</span>
    {
        [Test]
        <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">IsNowLunchBreak_should_return_false_when_11_oclock</span>()
        {
            <span class="pl-c">// `IndirectionsContext` can minimize the influence of the API replacement.</span>
            <span class="pl-k">using</span> (<span class="pl-k">new</span> IndirectionsContext())
            {
                <span class="pl-c">// Arrange</span>
                <span class="pl-c">// `PDateTime` is the class that is generated automatically by Prig.</span>
                <span class="pl-c">// We call such class "Prig Type". You can replace the method body of </span>
                <span class="pl-c">// `DateTime.Now` by using that.</span>
                PDateTime.NowGet().Body = () =&gt; <span class="pl-k">new</span> DateTime(<span class="pl-c1">2013</span>, <span class="pl-c1">12</span>, <span class="pl-c1">13</span>, <span class="pl-c1">11</span>, <span class="pl-c1">00</span>, <span class="pl-c1">00</span>);
                <span class="pl-c">// Hereafter, `DateTime.Now` will return only `2013/12/13 11:00:00`.</span>

                <span class="pl-c">// Act</span>
                <span class="pl-k">var</span> result = LifeInfo.IsNowLunchBreak();

                <span class="pl-c">// Assert</span>
                Assert.IsFalse(result);
            }
        }

        <span class="pl-c">// In the same way, add the test case to cover other branches...</span>
        [Test]
        <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">IsNowLunchBreak_should_return_true_when_12_oclock</span>()
        {
            <span class="pl-k">using</span> (<span class="pl-k">new</span> IndirectionsContext())
            {
                <span class="pl-c">// Arrange</span>
                PDateTime.NowGet().Body = () =&gt; <span class="pl-k">new</span> DateTime(<span class="pl-c1">2013</span>, <span class="pl-c1">12</span>, <span class="pl-c1">13</span>, <span class="pl-c1">12</span>, <span class="pl-c1">00</span>, <span class="pl-c1">00</span>);

                <span class="pl-c">// Act</span>
                <span class="pl-k">var</span> result = LifeInfo.IsNowLunchBreak();

                <span class="pl-c">// Assert</span>
                Assert.IsTrue(result);
            }
        }

        [Test]
        <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">IsNowLunchBreak_should_return_false_when_13_oclock</span>()
        {
            <span class="pl-k">using</span> (<span class="pl-k">new</span> IndirectionsContext())
            {
                <span class="pl-c">// Arrange</span>
                PDateTime.NowGet().Body = () =&gt; <span class="pl-k">new</span> DateTime(<span class="pl-c1">2013</span>, <span class="pl-c1">12</span>, <span class="pl-c1">13</span>, <span class="pl-c1">13</span>, <span class="pl-c1">00</span>, <span class="pl-c1">00</span>);

                <span class="pl-c">// Act</span>
                <span class="pl-k">var</span> result = LifeInfo.IsNowLunchBreak();

                <span class="pl-c">// Assert</span>
                Assert.IsFalse(result);
            }
        }
    }
}</pre></div>

<h3>
<a id="step-5-install-test-adapter" class="anchor" href="#step-5-install-test-adapter" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 5: Install Test Adapter</h3>

<p>Before running tests in Visual Studio Test Explorer, you have to install a Test Adapter. Currently, Prig supports the following Test Adapters: NUnit, MSTest, <a href="https://www.nuget.org/packages/xunit.runner.visualstudio/">xUnit.net</a>. As the above described sample, let we use NUnit. Now, in the Package Manager Console, change the <code>Package source</code> to <code>Prig Source</code>, the <code>Default project</code> to <code>QuickTourTest</code> and execute the following command: </p>

<div class="highlight highlight-source-powershell"><pre>PM<span class="pl-k">&gt;</span> <span class="pl-c1">Install-Package</span> NUnitTestAdapterForPrig</pre></div>

<p><strong>NOTE:</strong> Unfortunately, you can't use official <a href="https://www.nuget.org/packages/NUnitTestAdapter/">NUnit Test Adapter</a> because it doesn't support any configurations like prime NUnit which is supported, e.g. <a href="http://www.nunit.org/index.php?p=settingsDialog&amp;r=2.6.4">NUnit Gui Runner's Settings</a> and <a href="http://www.nunit.org/index.php?p=consoleCommandLine&amp;r=2.6.4">NUnit-Console's Settings</a>.</p>

<p>After install, build the test project and choose the menu <code>TEST</code> - <code>Windows</code> - <code>Test Explorer</code>. Then, you can find runnable tests in the Test Explorer.<br>
<img src="https://cdn.rawgit.com/urasandesu/Prig/master/Urasandesu.Prig.VSPackage/Resources/Step%205%20Install%20Test%20Adapter%2001.png" alt="Install Test Adapter 01"></p>

<p>When Test Adapter was installed successfully, you can also modify the <code>Test Settings</code>. As the following image, change <code>Default Processor Architecture</code> to <code>x64</code> and uncheck <code>Keep Test Execution Engine Running</code>:<br>
<img src="https://cdn.rawgit.com/urasandesu/Prig/master/Urasandesu.Prig.VSPackage/Resources/Step%205%20Install%20Test%20Adapter%2002.png" alt="Install Test Adapter 02"></p>

<h3>
<a id="step-6-run-tests" class="anchor" href="#step-6-run-tests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Step 6: Run Tests</h3>

<p>In fact, to enable any profiler based mocking tool, you have to set the environment variables. Therefore, such libraries - Microsoft Fakes/Typemock Isolator/Telerik JustMock provide small runner to satisfy the requisition, also it is true at Prig. Choose the menu <code>PRIG</code> - <code>Enable Test Adapter for ConsoleApplicationTest</code>:<br>
<img src="https://cdn.rawgit.com/urasandesu/Prig/master/Urasandesu.Prig.VSPackage/Resources/Step%206%20Run%20Tests%2001.png" alt="Run Tests 01"></p>

<p>Then, execute <code>TEST</code> - <code>Run</code> - <code>All Tests</code>, you can get test results in the Test Explorer.<br>
<img src="https://cdn.rawgit.com/urasandesu/Prig/master/Urasandesu.Prig.VSPackage/Resources/Step%206%20Run%20Tests%2002.png" alt="Run Tests 02"></p>

<h3>
<a id="final-step-refactoring-and-get-trig-back" class="anchor" href="#final-step-refactoring-and-get-trig-back" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Final Step: Refactoring and Get Trig Back!</h3>

<p>If tests have been created, you can refactor illimitably! For example, you probably can find the result of refactoring as follows: </p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> System<span class="pl-k">;</span>

<span class="pl-k">namespace</span> <span class="pl-en">QuickTour</span>
{
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">LifeInfo</span>
    {
        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">bool</span> <span class="pl-en">IsNowLunchBreak</span>()
        {
            <span class="pl-c">// 1. Add overload to isolate from external environment then call it from original method.</span>
            <span class="pl-k">return</span> IsNowLunchBreak(DateTime.Now);
        }

        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">bool</span> <span class="pl-en">IsNowLunchBreak</span>(<span class="pl-k">DateTime</span> <span class="pl-smi">now</span>)
        {
            <span class="pl-c">// 2. Also, I think the expression '12 &lt;= now.Hour &amp;&amp; now.Hour &lt; 13' is too complex.</span>
            <span class="pl-c">//    Better this way, isn't it?</span>
            <span class="pl-k">return</span> now.Hour == <span class="pl-c1">12</span>;
        }
        <span class="pl-c">// 3. After refactoring, no longer need to use Prig, because you can test this overload.</span>
    }
}</pre></div>

<p>As just described, Prig helps the code that depends on an untestable library gets trig back. I guarantee you will enjoy your development again!!</p>

<p>For more information, see also <a href="https://github.com/urasandesu/Prig/wiki">Prig's wiki</a>.</p>

<h1>
<a id="installation-from-source-code" class="anchor" href="#installation-from-source-code" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>INSTALLATION FROM SOURCE CODE</h1>

<h2>
<a id="dependency" class="anchor" href="#dependency" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DEPENDENCY</h2>

<p>To build this project needs the following dependencies: </p>

<ul>
<li><a href="http://www.visualstudio.com/">Visual Studio 2013(more than Professional Edition because it uses ATL. Also, you can use Community Edition)</a></li>
<li>
<a href="http://www.boost.org/users/history/version_1_60_0.html">Boost 1.60.0</a><br>
Extract to C:\boost_1_60_0, and will build with the following options(x86 and x64 libs are required):</li>
</ul>

<pre lang="dos"><code>CMD boost_1_60_0&gt;cd
C:\boost_1_60_0

CMD boost_1_60_0&gt;bootstrap.bat
Building Boost.Build engine

Bootstrapping is done. To build, run:

    .\b2

To adjust configuration, edit 'project-config.jam'.
Further information:
...

CMD boost_1_60_0&gt;.\b2 link=static threading=multi variant=debug,release runtime-link=shared,static -j 4

Building the Boost C++ Libraries.

Performing configuration checks
...

CMD boost_1_60_0&gt;.\b2 link=static threading=multi variant=debug,release runtime-link=shared,static -j 4 --stagedir=.\stage\x64 address-model=64

Building the Boost C++ Libraries.

Performing configuration checks
...
</code></pre>

<ul>
<li>
<a href="https://code.google.com/p/googletest/">Google Test 1.6</a><br>
Extract to C:\gtest-1.6.0, and upgrade C:\gtest-1.6.0\msvc\gtest.sln to Visual Studio 2013. Choose the <code>Build</code> menu, and open <code>Configuration Manager...</code>. On <code>Configuration Manager</code> dialog box, in the <code>Active Solution Platform</code> drop-down list, choose the <code>&lt;New...&gt;</code> option. After the <code>New Solution Platform</code> dialog box is opened, in the <code>Type or select the new platform</code> drop-down list, select a 64-bit platform. Then build all(Debug/Release) configurations.</li>
<li>
<a href="http://www.nunit.org/">NUnit 2.6.3.13283</a><br>
Install using with the installer(NUnit-2.6.3.msi).</li>
<li>
<a href="http://www.microsoft.com/en-us/download/details.aspx?id=40754">Modeling SDK for Microsoft Visual Studio 2013</a><br>
Install using with the installer(VS_VmSdk.exe).</li>
<li>
<a href="http://www.microsoft.com/en-us/download/details.aspx?id=40758">Microsoft Visual Studio 2013 SDK</a><br>
Install using with the installer(vssdk_full.exe).</li>
<li>
<a href="http://nant.sourceforge.net/">NAnt</a><br>
You can also install in accordance with <a href="http://nant.sourceforge.net/release/latest/help/introduction/installation.html">the help</a>, but the easiest way is using Chocolatey: <code>choco install nant</code>.</li>
</ul>

<h2>
<a id="build" class="anchor" href="#build" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>BUILD</h2>

<h3>
<a id="from-powershell-script" class="anchor" href="#from-powershell-script" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>From PowerShell Script</h3>

<p>Run Developer Command Prompt for VS2013 as Administrator, and execute the following commands: </p>

<pre lang="dos"><code>CMD Prig&gt; cd
C:\Users\User\Prig

CMD Prig&gt; powershell
Windows PowerShell
Copyright (C) 2014 Microsoft Corporation. All rights reserved.


PS Prig&gt; .\Build.ps1
...

PS Prig&gt;

</code></pre>

<p><strong>NOTE:</strong> It takes somewhere round 30 minutes.</p>

<h3>
<a id="from-visual-studio" class="anchor" href="#from-visual-studio" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>From Visual Studio</h3>

<p>After preparing all dependencies, you can build this project in the following steps:</p>

<ol>
<li>Run Visual Studio as Administrator, and open Prig.sln(This sln contains some ATL projects, so the build process will modify registry).</li>
<li>According to the version of the product to use, change the solution configuration and the solution platform and build.</li>
<li>The results are output to <code>$(SolutionDir)$(Configuration)\$(PlatformTarget)\</code>.</li>
</ol>

<h2>
<a id="registration" class="anchor" href="#registration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>REGISTRATION</h2>

<p>If you built Prig by PowerShell script, <code>Prig.vsix</code> will be output to <code>&lt;top level directory you cloned&gt;\Release\x86</code> directory. You can install by double clicking that. After that, do installation procedure same as the beginning; choose the menu <code>PRIG</code> - <code>Register Prig (Needs Restarting)</code>.</p>

<h2>
<a id="unregistration" class="anchor" href="#unregistration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>UNREGISTRATION</h2>

<p>At first, choose the menu <code>PRIG</code> - <code>Unregister Prig (Needs Restarting)</code>. After you once restart Visual Studio, uninstall the VSIX; choose <code>TOOLS</code> - <code>Extensions and Updates...</code>, search <code>Installed</code> for <code>prig</code> and click <code>Uninstall</code>.</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
